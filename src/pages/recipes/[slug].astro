---
import recipes from "../../data/recipes";
import BaseLayout from "../../layouts/BaseLayout.astro";
import NutritionTable from "../../components/NutritionTable.astro";
import Nutrient from "../../components/Nutrient.astro";
import RecipeHighlight from "../../components/RecipeHighlight.astro";

export function getStaticPaths() {
  return recipes.map(({ slug, ...props }) => {
    return {
      params: { slug: slug },
      props: { ...props },
    };
  });
}
const props = Astro.props;
const renderNutrition = Object.entries(props.nutrition);
---

<BaseLayout title={props.title}>
  <RecipeHighlight
    title={props.title}
    author={props.author}
    description={props.description}
    imgSrc={props.imgSrc}
  />

  <section class="recipe-details">
    <aside class="recipe-instructions">
      <div class="recipe-config">
        <div class="group-select">
          <h6 class="group-title uppercase">Serving Size</h6>
          <div class="radio-group">
            <label for="half-serving">
              <span>&half;x</span>
              <input type="radio" name="serving" id="half-serving" />
            </label>
            <label for="one-serving">
              <span>1x</span>
              <input type="radio" name="serving" id="one-serving" checked />
            </label>
            <label for="double-serving">
              <span>2x</span>
              <input type="radio" name="serving" id="double-serving" />
            </label>
          </div>
        </div>

        <div class="group-select">
          <h6 class="group-title uppercase">Unit</h6>
          <div class="radio-group">
            <label for="imperial">
              <span>US</span>
              <input type="radio" name="unit" id="imperial" checked />
            </label>
            <label for="metric">
              <span>M</span>
              <input type="radio" name="unit" id="metric" />
            </label>
          </div>
        </div>
      </div>

      <div class="list-container">
        <h3 class="list-caption">Ingredients</h3>
        <ul>
          {
            props.ingredients.quantified.map(({ amount, unit, item }) => {
              if (unit == "g" || unit == "oz") {
                return (
                  <li>
                    {amount}
                    {unit} {item}
                  </li>
                );
              }
              return (
                <li>
                  {amount} {unit} {item}
                </li>
              );
            })
          }
          {
            props.ingredients.unquantified.map((value) => {
              return <li>{value}</li>;
            })
          }
        </ul>
      </div>

      <div class="list-container">
        <h3 class="list-caption">Directions</h3>
        <ol>
          {
            props.steps.map((step, index) => {
              return <li data-counter={`Step ${index + 1}`}>{step}</li>;
            })
          }
        </ol>
      </div>
    </aside>
    <aside class="recipe-nutrition">
      <aside class="nutrition-facts">
        <span><strong>Prep Time:</strong> <br />30 mins</span>
        <span><strong>Cook Time:</strong> <br />1hr 30 mins</span>
        <span><strong>Total Time:</strong> <br />2hrs</span>
        <span><strong>Freezeable:</strong> <br />Yes</span>
        <span><strong>Difficulty:</strong> <br />Medium</span>
        <span><strong>Servings:</strong><br />4</span>
      </aside>

      <NutritionTable servings="4" calories={props.calories}>
        {
          renderNutrition.map(([key, details]) => {
            return (
              <>
                <Nutrient
                  label={details.label}
                  amount={details.amount}
                  percent={details.percent}
                />
                {details.subtypes &&
                  details.subtypes.map(({ label, amount, percent }) => {
                    return (
                      <Nutrient
                        label={label}
                        amount={amount}
                        percent={percent}
                        type="sub"
                      />
                    );
                  })}
              </>
            );
          })
        }
      </NutritionTable>
    </aside>
  </section>
</BaseLayout>
